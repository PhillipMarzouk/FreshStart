{% extends "base.html" %}
{% load static %}

{% block title %}Weekly Menu{% endblock %}

{% block content %}
    <h1>Weekly Menu</h1>

    <!-- Navigation for Weeks -->
    <div class="week-navigation">
        <a href="{% url 'menu' %}?date={{ prev_week|date:'Y-m-d' }}" class="nav-button">&laquo; Previous Week</a>
        <a href="{% url 'menu' %}?date={{ prev_week|date:'Y-m-d' }}" class="previous-week">&laquo;</a>
        <span class="week-range">
            Week of {{ selected_week|date:"F j, Y" }}
        </span>
        <a href="{% url 'menu' %}?date={{ next_week|date:'Y-m-d' }}" class="nav-button">Next Week &raquo;</a>
        <a href="{% url 'menu' %}?date={{ next_week|date:'Y-m-d' }}" class="next-week">&raquo;</a>
    </div>
    
    <!-- Filter by Lunch Program -->
    <form method="GET" action="{% url 'menu' %}" class="filter-form">
        <div class="dropdown">
            <button class="dropdown-toggle" id="dropdownButton" type="button">
                <span id="dropdownText">{{ selected_program|default:"Select Lunch Program" }}</span>
            </button>
            <ul class="dropdown-menu" id="dropdownMenu">
                <li data-value="">All Programs</li>
                {% for program in lunch_programs %}
                    <li data-value="{{ program.name }}">{{ program.name }}</li>
                {% endfor %}
            </ul>
            <input type="hidden" name="program" id="selectedProgram" value="{{ selected_program|default_if_none:'' }}">
        </div>
    
        <button type="submit" class="filter-submit">Apply Filter</button>
    </form>

    <hr>

    <!-- Display Menu for Each Day -->
    {% for day, menu_items in weekly_menu.items %}
        <h2>{{ day|date:"l - F j, Y" }}</h2>
        {% if menu_items %}
            <ul class="menu-list">
                {% for item in menu_items %}
                    <li class="menu-item">
                        <!-- Meal Image -->
                        {% if item.image %}
                            <img src="{{ item.image.url }}" alt="{{ item.plate_name }}" class="meal-image">
                        {% else %}
                            <img src="{% static 'images/placeholder.png' %}" alt="No Image" class="meal-image">
                        {% endif %}

                        <!-- Meal Info -->
                        <div class="meal-info">
                            <h3>{{ item.plate_name }}</h3>
                            {% if item.is_new %}
                                    <span class="new-badge">New</span>  <!-- ✅ New Badge Added -->
                                {% endif %}
                            <p><strong>Type:</strong> {{ item.meal_type }}</p>

                            <!-- ✅ New row: Includes -->
                            <p><strong>Includes:</strong> 
                                {% for portion in item.plate_portions.all %}
                                    {{ portion.name }}{% if not forloop.last %}, {% endif %}
                                {% empty %}
                                    No portions specified.
                                {% endfor %}
                            </p>
                        </div>
                    </li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No menu items available for this day.</p>
        {% endif %}
    {% endfor %}

    <!-- JavaScript for Dropdown Menu -->
    <script src="{% static 'js/dropdown.js' %}"></script>

{% endblock %}
